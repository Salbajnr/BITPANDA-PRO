import{u as Y,a as K,r as l,j as e,N as Q,C as r,l as i,w as W,D as X,F as V,G as _,H as Z,T as ee,e as se,f as p,g,h as x,i as h,q as f,I as D,O as ae,B as te,R as le}from"./index-locF26TT.js";function ne(){const{user:E}=Y(),{toast:m}=K(),[y,B]=l.useState([]),[j,z]=l.useState([]),[b,O]=l.useState([]),[re,R]=l.useState(!0),[v,w]=l.useState(!1),[t,T]=l.useState(null),[u,F]=l.useState(""),[n,C]=l.useState(""),[d,$]=l.useState("buy"),[ie,I]=l.useState(0),[P,U]=l.useState(0);l.useEffect(()=>{S(),k(),L(),M()},[]);const S=async()=>{try{const s=await fetch("/api/metals/top/10");if(s.ok){const a=await s.json();B(a)}}catch(s){console.error("Failed to fetch metal prices:",s)}},k=async()=>{try{const s=await fetch("/api/metals-trading/holdings",{credentials:"include"});if(s.ok){const a=await s.json();z(a)}}catch(s){console.error("Failed to fetch holdings:",s)}},L=async()=>{try{const s=await fetch("/api/metals-trading/history",{credentials:"include"});if(s.ok){const a=await s.json();O(a)}}catch(s){console.error("Failed to fetch transactions:",s)}finally{R(!1)}},M=async()=>{try{const s=await fetch("/api/portfolio",{credentials:"include"});if(s.ok){const a=await s.json();U(parseFloat(a.availableCash)),I(parseFloat(a.totalValue))}}catch(s){console.error("Failed to fetch portfolio:",s)}},q=(s,a)=>{const c=parseFloat(s);return isNaN(c)||c<=0?"":(c*a).toFixed(2)},G=s=>{if(F(s),t){const a=q(s,t.price);C(a)}},J=async()=>{if(!t||!u||!n){m({title:"Error",description:"Please fill in all trade details",variant:"destructive"});return}w(!0);try{const s=`/api/metals-trading/${d}`,a={symbol:t.symbol,name:t.name,amount:u,price:t.price.toString(),total:n},c=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)}),H=await c.json();c.ok?(m({title:"Trade Successful",description:H.message,variant:"default"}),F(""),C(""),T(null),await Promise.all([k(),L(),M()])):m({title:"Trade Failed",description:H.message,variant:"destructive"})}catch(s){console.error("Trade execution error:",s),m({title:"Error",description:"Failed to execute trade",variant:"destructive"})}finally{w(!1)}},N=j.reduce((s,a)=>s+a.currentValue,0),o=j.reduce((s,a)=>s+a.profitLoss,0),A=N>0?o/(N-o)*100:0;return E?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Metals Trading"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Trade precious metals with real-time pricing and secure storage"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(r,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Metals Value"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",N.toFixed(2)]})]}),e.jsx(W,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(r,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Available Cash"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",P.toFixed(2)]})]}),e.jsx(X,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(r,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total P&L"}),e.jsxs("p",{className:`text-2xl font-bold ${o>=0?"text-green-600":"text-red-500"}`,children:["$",o.toFixed(2)]})]}),o>=0?e.jsx(V,{className:"w-8 h-8 text-green-600"}):e.jsx(_,{className:"w-8 h-8 text-red-500"})]})})}),e.jsx(r,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"P&L Percentage"}),e.jsxs("p",{className:`text-2xl font-bold ${A>=0?"text-green-600":"text-red-500"}`,children:[A.toFixed(2),"%"]})]}),e.jsx(Z,{className:"w-8 h-8 text-purple-600"})]})})})]}),e.jsxs(ee,{defaultValue:"trade",className:"space-y-6",children:[e.jsxs(se,{className:"grid w-full grid-cols-4",children:[e.jsx(p,{value:"trade",children:"Trade"}),e.jsx(p,{value:"holdings",children:"Holdings"}),e.jsx(p,{value:"history",children:"History"}),e.jsx(p,{value:"market",children:"Market"})]}),e.jsx(g,{value:"trade",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsx(x,{children:e.jsx(h,{children:"Select Metal"})}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:y.map(s=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${t?.symbol===s.symbol?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>T(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.symbol})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold",children:["$",s.price.toFixed(2)]}),e.jsxs("p",{className:`text-sm ${s.change_24h>=0?"text-green-600":"text-red-500"}`,children:[s.change_24h>=0?"+":"",s.change_24h.toFixed(2),"%"]})]})]})},s.symbol))})})]}),e.jsxs(r,{children:[e.jsx(x,{children:e.jsx(h,{children:"Trade Details"})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(f,{variant:d==="buy"?"default":"outline",onClick:()=>$("buy"),className:"flex-1",children:"Buy"}),e.jsx(f,{variant:d==="sell"?"default":"outline",onClick:()=>$("sell"),className:"flex-1",children:"Sell"})]}),t&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-semibold",children:t.name}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",t.price.toFixed(2),"/oz"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Amount (ounces)"}),e.jsx(D,{type:"number",step:"0.001",value:u,onChange:s=>G(s.target.value),placeholder:"Enter amount",disabled:!t})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Total Cost"}),e.jsx(D,{type:"text",value:n?`$${n}`:"",readOnly:!0,className:"bg-gray-50"})]}),d==="buy"&&n&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"w-4 h-4 text-yellow-600 mr-2"}),e.jsxs("span",{className:"text-sm text-yellow-800",children:["Available: $",P.toFixed(2)]})]})}),e.jsx(f,{onClick:J,disabled:!t||!u||v,className:"w-full",children:v?"Processing...":`${d==="buy"?"Buy":"Sell"} ${t?.name||"Metal"}`})]})})]})]})}),e.jsx(g,{value:"holdings",children:e.jsxs(r,{children:[e.jsx(x,{children:e.jsx(h,{children:"Your Metal Holdings"})}),e.jsx(i,{children:j.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No metal holdings found"}):e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.amount," oz"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold",children:["$",s.currentValue.toFixed(2)]}),e.jsxs("p",{className:`text-sm ${s.profitLoss>=0?"text-green-600":"text-red-500"}`,children:[s.profitLoss>=0?"+":"","$",s.profitLoss.toFixed(2),"(",s.profitLossPercent.toFixed(2),"%)"]})]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsx("div",{children:e.jsxs("span",{children:["Avg Price: $",parseFloat(s.averagePurchasePrice).toFixed(2)]})}),e.jsx("div",{children:e.jsxs("span",{children:["Current: $",s.currentPrice.toFixed(2)]})})]})]},s.id))})})]})}),e.jsx(g,{value:"history",children:e.jsxs(r,{children:[e.jsx(x,{children:e.jsx(h,{children:"Trading History"})}),e.jsx(i,{children:b.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No trading history found"}):e.jsx("div",{className:"space-y-4",children:b.map(s=>e.jsx("div",{className:"p-4 border rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{variant:s.type==="buy"?"default":"secondary",children:s.type.toUpperCase()}),e.jsx("span",{className:"font-semibold",children:s.symbol})]}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold",children:["$",parseFloat(s.total).toFixed(2)]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.amount," oz @ $",parseFloat(s.price).toFixed(2)]})]})]})},s.id))})})]})}),e.jsx(g,{value:"market",children:e.jsxs(r,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center justify-between",children:["Market Prices",e.jsxs(f,{onClick:S,variant:"outline",size:"sm",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})}),e.jsx(i,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:y.map(s=>e.jsx("div",{className:"p-4 border rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.symbol})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xl font-bold",children:["$",s.price.toFixed(2)]}),e.jsxs("p",{className:`text-sm flex items-center ${s.change_24h>=0?"text-green-600":"text-red-500"}`,children:[s.change_24h>=0?e.jsx(V,{className:"w-4 h-4 mr-1"}):e.jsx(_,{className:"w-4 h-4 mr-1"}),s.change_24h>=0?"+":"",s.change_24h.toFixed(2),"%"]})]})]})},s.symbol))})})]})})]})]})]}):e.jsx("div",{children:"Please log in to access metals trading"})}export{ne as default};
