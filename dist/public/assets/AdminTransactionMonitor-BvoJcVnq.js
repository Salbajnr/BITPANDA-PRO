import{W as de,a as xe,b as oe,r as d,c as z,d as L,j as e,q as r,a0 as me,R as he,C as x,l as o,D as je,Q as G,_ as ue,O as S,T as pe,e as ge,f as U,g as P,h as g,i as v,L as t,af as ve,I as Ne,ag as I,ah as q,ai as O,aj as B,ak as i,B as j,o as H,p as W,a8 as _,s as fe,t as ye,v as be,a6 as we,al as Te,a2 as N,G as Se,F as Ce,am as ke,an as Ae}from"./index-locF26TT.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=de("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);function Re(){const{toast:C}=xe(),f=oe(),[J,X]=d.useState("overview"),[y,Y]=d.useState(""),[b,Z]=d.useState("all"),[w,ee]=d.useState("all"),[k,se]=d.useState("7d"),[a,M]=d.useState(null),[T,ae]=d.useState(""),[m,V]=d.useState(1),[u,le]=d.useState(!1),{data:n}=z({queryKey:["/api/admin/transactions/stats",k],queryFn:()=>N("GET",`/api/admin/transactions/stats?range=${k}`),refetchInterval:3e4}),{data:Q,isLoading:te}=z({queryKey:["/api/admin/transactions",m,y,b,w,u],queryFn:()=>{const s=new URLSearchParams({page:m.toString(),limit:"20",...y&&{search:y},...b!=="all"&&{type:b},...w!=="all"&&{status:w},...u&&{suspicious:"true"}});return N("GET",`/api/admin/transactions?${s}`)},refetchInterval:1e4}),ie=L({mutationFn:({id:s,flagged:l,notes:D})=>N("POST",`/api/admin/transactions/${s}/flag`,{flagged:l,notes:D}),onSuccess:()=>{C({title:"Transaction Updated",description:"Transaction flag status has been updated."}),f.invalidateQueries({queryKey:["/api/admin/transactions"]})}}),ne=L({mutationFn:({id:s,reason:l})=>N("POST",`/api/admin/transactions/${s}/suspend`,{reason:l}),onSuccess:()=>{C({title:"Transaction Suspended",description:"Transaction has been suspended successfully."}),f.invalidateQueries({queryKey:["/api/admin/transactions"]})}}),re=L({mutationFn:({id:s,reason:l})=>N("POST",`/api/admin/transactions/${s}/reverse`,{reason:l}),onSuccess:()=>{C({title:"Transaction Reversed",description:"Transaction has been reversed successfully."}),f.invalidateQueries({queryKey:["/api/admin/transactions"]})}}),A=s=>{const l={completed:"bg-green-100 text-green-800 border-green-300",pending:"bg-yellow-100 text-yellow-800 border-yellow-300",failed:"bg-red-100 text-red-800 border-red-300",cancelled:"bg-gray-100 text-gray-800 border-gray-300",suspended:"bg-orange-100 text-orange-800 border-orange-300"};return e.jsx(j,{className:l[s]||l.pending,children:s.toUpperCase()})},E=s=>{switch(s){case"buy":return e.jsx(Ae,{className:"h-4 w-4 text-green-600"});case"sell":return e.jsx(ke,{className:"h-4 w-4 text-red-600"});case"deposit":return e.jsx(Ce,{className:"h-4 w-4 text-blue-600"});case"withdrawal":return e.jsx(Se,{className:"h-4 w-4 text-purple-600"});default:return e.jsx(G,{className:"h-4 w-4 text-gray-600"})}},K=s=>s?s>=80?e.jsx(j,{variant:"destructive",className:"ml-2",children:"High Risk"}):s>=50?e.jsx(j,{className:"bg-yellow-100 text-yellow-800 ml-2",children:"Medium Risk"}):s>=30?e.jsx(j,{variant:"outline",className:"ml-2",children:"Low Risk"}):null:null,h=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(parseFloat(s)),$=s=>{ie.mutate({id:s.id,flagged:!s.flagged,notes:T||`Transaction ${s.flagged?"unflagged":"flagged"} by admin`})},F=Q?.transactions||[],p=Q?.pagination||{};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Transaction Monitor"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Monitor and manage all platform transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(r,{variant:"outline",onClick:()=>{const s=F.map(c=>({id:c.id,user:c.username,type:c.type,symbol:c.symbol,amount:c.amount,total:c.total,status:c.status,date:new Date(c.createdAt).toLocaleString()})),l=[Object.keys(s[0]).join(","),...s.map(c=>Object.values(c).join(","))].join(`
`),D=new Blob([l],{type:"text/csv"}),ce=URL.createObjectURL(D),R=document.createElement("a");R.href=ce,R.download="transactions.csv",R.click()},className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Export CSV"]}),e.jsxs(r,{onClick:()=>f.invalidateQueries({queryKey:["/api/admin/transactions"]}),variant:"outline",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(x,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Total Volume"}),e.jsx("p",{className:"text-2xl font-bold",children:h(n.totalVolume.toString())})]}),e.jsx(je,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(x,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold",children:n.totalTransactions.toLocaleString()})]}),e.jsx(G,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(x,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold",children:n.pendingTransactions})]}),e.jsx(ue,{className:"h-8 w-8 text-yellow-600"})]})})}),e.jsx(x,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Suspicious"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:n.suspiciousTransactions})]}),e.jsx(S,{className:"h-8 w-8 text-red-600"})]})})})]}),e.jsxs(pe,{value:J,onValueChange:X,children:[e.jsxs(ge,{className:"grid w-full grid-cols-3",children:[e.jsx(U,{value:"overview",children:"Overview"}),e.jsx(U,{value:"transactions",children:"All Transactions"}),e.jsx(U,{value:"analytics",children:"Analytics"})]}),e.jsxs(P,{value:"overview",className:"space-y-6",children:[e.jsxs(x,{children:[e.jsx(g,{children:e.jsx(v,{children:"Quick Filters"})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx(Ne,{id:"search",placeholder:"User, transaction ID...",value:y,onChange:s=>Y(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"type-filter",children:"Type"}),e.jsxs(I,{value:b,onValueChange:Z,children:[e.jsx(q,{children:e.jsx(O,{})}),e.jsxs(B,{children:[e.jsx(i,{value:"all",children:"All Types"}),e.jsx(i,{value:"buy",children:"Buy"}),e.jsx(i,{value:"sell",children:"Sell"}),e.jsx(i,{value:"deposit",children:"Deposit"}),e.jsx(i,{value:"withdrawal",children:"Withdrawal"})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"status-filter",children:"Status"}),e.jsxs(I,{value:w,onValueChange:ee,children:[e.jsx(q,{children:e.jsx(O,{})}),e.jsxs(B,{children:[e.jsx(i,{value:"all",children:"All Status"}),e.jsx(i,{value:"completed",children:"Completed"}),e.jsx(i,{value:"pending",children:"Pending"}),e.jsx(i,{value:"failed",children:"Failed"}),e.jsx(i,{value:"suspended",children:"Suspended"})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"date-range",children:"Date Range"}),e.jsxs(I,{value:k,onValueChange:se,children:[e.jsx(q,{children:e.jsx(O,{})}),e.jsxs(B,{children:[e.jsx(i,{value:"1d",children:"Last 24h"}),e.jsx(i,{value:"7d",children:"Last 7 days"}),e.jsx(i,{value:"30d",children:"Last 30 days"}),e.jsx(i,{value:"90d",children:"Last 90 days"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(r,{variant:u?"default":"outline",onClick:()=>le(!u),className:"w-full",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),u?"Show All":"Suspicious Only"]})})]})})]}),e.jsxs(x,{children:[e.jsx(g,{children:e.jsx(v,{children:"Recent Transactions"})}),e.jsx(o,{children:te?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,l)=>e.jsx("div",{className:"h-16 bg-slate-200 dark:bg-slate-700 rounded animate-pulse"},l))}):e.jsx("div",{className:"space-y-4",children:F.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[E(s.type),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.username}),s.flagged&&e.jsx(j,{variant:"destructive",className:"text-xs",children:"Flagged"}),K(s.riskScore)]}),e.jsxs("p",{className:"text-sm text-slate-500",children:[s.type.toUpperCase()," • ",s.symbol||"N/A"," • ",new Date(s.createdAt).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold",children:h(s.total)}),e.jsxs("p",{className:"text-sm text-slate-500",children:[s.amount," ",s.symbol||"USD"]})]}),A(s.status),e.jsx(H,{children:e.jsx(W,{asChild:!0,children:e.jsx(r,{variant:"outline",size:"sm",onClick:()=>M(s),children:e.jsx(_,{className:"h-4 w-4"})})})})]})]},s.id))})})]})]}),e.jsx(P,{value:"transactions",className:"space-y-6",children:e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(v,{children:["All Transactions (",p.total||0,")"]})}),e.jsxs(o,{children:[e.jsx("div",{className:"space-y-4",children:F.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[E(s.type),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.username}),e.jsxs("span",{className:"text-sm text-slate-500",children:["(",s.email,")"]}),s.flagged&&e.jsx(j,{variant:"destructive",className:"text-xs",children:"Flagged"}),K(s.riskScore)]}),e.jsxs("p",{className:"text-sm text-slate-500",children:["ID: ",s.id," • ",s.type.toUpperCase()," • ",s.symbol||"N/A"]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[new Date(s.createdAt).toLocaleString()," • IP: ",s.ipAddress||"N/A"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold",children:h(s.total)}),e.jsxs("p",{className:"text-sm text-slate-500",children:[s.amount," ",s.symbol||"USD"]}),s.fees&&parseFloat(s.fees)>0&&e.jsxs("p",{className:"text-xs text-slate-400",children:["Fee: ",h(s.fees)]})]}),A(s.status),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>$(s),className:s.flagged?"bg-red-50 border-red-200":"",children:e.jsx(S,{className:"h-4 w-4"})}),e.jsxs(H,{children:[e.jsx(W,{asChild:!0,children:e.jsx(r,{variant:"outline",size:"sm",onClick:()=>M(s),children:e.jsx(_,{className:"h-4 w-4"})})}),e.jsxs(fe,{className:"max-w-2xl",children:[e.jsx(ye,{children:e.jsx(be,{children:"Transaction Details"})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Transaction ID"}),e.jsx("p",{className:"font-mono text-sm",children:a.id})]}),e.jsxs("div",{children:[e.jsx(t,{children:"User"}),e.jsxs("p",{children:[a.username," (",a.email,")"]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Type"}),e.jsx("p",{className:"capitalize",children:a.type})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Status"}),e.jsx("div",{children:A(a.status)})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Amount"}),e.jsxs("p",{children:[a.amount," ",a.symbol]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Total Value"}),e.jsx("p",{className:"font-bold",children:h(a.total)})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Fees"}),e.jsx("p",{children:h(a.fees||"0")})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Created"}),e.jsx("p",{children:new Date(a.createdAt).toLocaleString()})]})]}),a.notes&&e.jsxs("div",{children:[e.jsx(t,{children:"Notes"}),e.jsx("p",{className:"text-sm bg-slate-50 p-2 rounded",children:a.notes})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"admin-notes",children:"Admin Notes"}),e.jsx(we,{id:"admin-notes",placeholder:"Add admin notes...",value:T,onChange:l=>ae(l.target.value)})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[a.status==="completed"&&e.jsxs(r,{variant:"destructive",onClick:()=>re.mutate({id:a.id,reason:T||"Admin reversal"}),children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Reverse Transaction"]}),a.status!=="suspended"&&e.jsxs(r,{variant:"outline",onClick:()=>ne.mutate({id:a.id,reason:T||"Admin suspension"}),children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Suspend"]}),e.jsxs(r,{onClick:()=>$(a),className:a.flagged?"bg-red-600 hover:bg-red-700":"",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),a.flagged?"Unflag":"Flag"]})]})]})]})]})]})]})]},s.id))}),p.pages>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("p",{className:"text-sm text-slate-600",children:["Showing ",(m-1)*20+1," to ",Math.min(m*20,p.total)," of ",p.total," results"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(r,{variant:"outline",onClick:()=>V(m-1),disabled:m===1,children:"Previous"}),e.jsx(r,{variant:"outline",onClick:()=>V(m+1),disabled:m===p.pages,children:"Next"})]})]})]})]})}),e.jsx(P,{value:"analytics",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(x,{children:[e.jsx(g,{children:e.jsx(v,{children:"Top Trading Pairs"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:n?.topTradingPairs?.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-800",children:l+1})}),e.jsx("span",{className:"font-medium",children:s.symbol})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold",children:h(s.volume.toString())}),e.jsxs("p",{className:"text-sm text-slate-500",children:[s.count," trades"]})]})]},s.symbol))})})]}),e.jsxs(x,{children:[e.jsx(g,{children:e.jsx(v,{children:"Transaction Status Distribution"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{children:"Completed"})]}),e.jsx("span",{className:"font-medium",children:(n?.totalTransactions||0)-(n?.pendingTransactions||0)-(n?.failedTransactions||0)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsx("span",{children:"Pending"})]}),e.jsx("span",{className:"font-medium",children:n?.pendingTransactions||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{children:"Failed"})]}),e.jsx("span",{className:"font-medium",children:n?.failedTransactions||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full"}),e.jsx("span",{children:"Suspicious"})]}),e.jsx("span",{className:"font-medium",children:n?.suspiciousTransactions||0})]})]})})]})]})})]})]})}export{Re as default};
