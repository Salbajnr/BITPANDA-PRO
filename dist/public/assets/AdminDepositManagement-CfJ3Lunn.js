import{W as E,u as F,r as a,aH as n,j as e,R as w,q as r,C as l,l as i,B as y,ay as I,a8 as $,aI as B,aJ as M,aK as O,o as U,s as H,t as L,v as z,a6 as q}from"./index-locF26TT.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=E("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);function _(){const{user:v}=F(),[u,k]=a.useState([]),[A,D]=a.useState(!0),[c,x]=a.useState(""),[o,N]=a.useState(null),[p,f]=a.useState(""),[R,h]=a.useState(!1);a.useEffect(()=>{if(v?.role!=="admin"){window.location.href="/dashboard";return}m()},[v]);const m=async()=>{try{const s=await fetch("/api/deposits/admin/all",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const P=(await s.json()).map(t=>({deposit:{id:t.id,paymentMethod:t.paymentMethod,cryptocurrency:t.currency,depositAmount:t.amount,depositAddress:"N/A",proofOfPayment:t.proofImageUrl||"N/A",proofType:t.proofImageUrl?"file":"hash",status:t.status,rejectionReason:t.rejectionReason,createdAt:t.createdAt,updatedAt:t.updatedAt},user:{id:t.userId,email:t.email||"N/A",name:t.firstName&&t.lastName?`${t.firstName} ${t.lastName}`:t.username||"N/A"}}));k(P)}else throw new Error("Failed to fetch deposits")}catch{n({title:"Error",description:"Failed to load deposits",variant:"destructive"})}finally{D(!1)}},C=async s=>{x(s);try{if((await fetch(`/api/deposits/${s}/approve`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)n({title:"Success",description:"Deposit approved successfully"}),m();else throw new Error("Failed to approve deposit")}catch{n({title:"Error",description:"Failed to approve deposit",variant:"destructive"})}finally{x("")}},S=async()=>{if(!o||!p.trim()){n({title:"Error",description:"Please provide a rejection reason",variant:"destructive"});return}x(o.deposit.id);try{if((await fetch(`/api/deposits/${o.deposit.id}/reject`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({rejectionReason:p.trim()})})).ok)n({title:"Success",description:"Deposit rejected successfully"}),h(!1),f(""),N(null),m();else throw new Error("Failed to reject deposit")}catch{n({title:"Error",description:"Failed to reject deposit",variant:"destructive"})}finally{x("")}},T=s=>{switch(s){case"approved":return"bg-green-500/10 text-green-400 border-green-500/20";case"rejected":return"bg-red-500/10 text-red-400 border-red-500/20";default:return"bg-green-500/10 text-green-400 border-green-500/20"}},b=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),j=u.filter(s=>s.deposit.status==="pending"),d=u.filter(s=>s.deposit.status!=="pending");return A?e.jsx("div",{className:"min-h-screen bg-slate-900 text-white p-6 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{children:"Loading deposits..."})]})}):e.jsx("div",{className:"min-h-screen bg-slate-900 text-white p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Deposit Management"}),e.jsxs(r,{onClick:m,variant:"outline",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-green-400",children:j.length}),e.jsx("p",{className:"text-gray-400",children:"Pending Review"})]})})}),e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-green-400",children:d.filter(s=>s.deposit.status==="approved").length}),e.jsx("p",{className:"text-gray-400",children:"Approved"})]})})}),e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-red-400",children:d.filter(s=>s.deposit.status==="rejected").length}),e.jsx("p",{className:"text-gray-400",children:"Rejected"})]})})}),e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-blue-400",children:u.length}),e.jsx("p",{className:"text-gray-400",children:"Total Deposits"})]})})})]}),j.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl font-semibold mb-4 text-green-400",children:["Pending Review (",j.length,")"]}),e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsx(l,{className:"bg-slate-800 border-green-500/20",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"User"}),e.jsx("p",{className:"text-white font-semibold",children:s.user.name}),e.jsx("p",{className:"text-gray-300 text-sm",children:s.user.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Amount"}),e.jsxs("p",{className:"text-white text-lg font-bold",children:[s.deposit.depositAmount," ",s.deposit.cryptocurrency]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Payment Method"}),e.jsx(y,{variant:"secondary",children:s.deposit.paymentMethod})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Deposit Address"}),e.jsx("code",{className:"text-xs text-green-400 bg-slate-900 p-2 rounded block break-all",children:s.deposit.depositAddress})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Proof Type"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.deposit.proofType==="file"?e.jsx(I,{className:"h-4 w-4 text-blue-400"}):e.jsx(J,{className:"h-4 w-4 text-purple-400"}),e.jsx("span",{className:"text-sm",children:s.deposit.proofType==="file"?"File Upload":"Transaction Hash"})]}),s.deposit.proofType==="hash"&&e.jsx("code",{className:"text-xs text-purple-400 bg-slate-900 p-2 rounded block break-all",children:s.deposit.proofOfPayment})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Submitted"}),e.jsx("p",{className:"text-white",children:b(s.deposit.createdAt)})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[s.deposit.proofType==="file"&&e.jsxs(r,{variant:"outline",className:"w-full",onClick:()=>window.open(`/api/deposits/proof/${s.deposit.id}`,"_blank"),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"View Proof File"]}),s.deposit.proofType==="hash"&&e.jsxs(r,{variant:"outline",className:"w-full",onClick:()=>{const g=`https://blockchair.com/search?q=${s.deposit.proofOfPayment}`;window.open(g,"_blank")},children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Verify on Blockchain"]}),e.jsxs(r,{onClick:()=>C(s.deposit.id),disabled:c===s.deposit.id,className:"w-full bg-green-600 hover:bg-green-700",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),c===s.deposit.id?"Approving...":"Approve"]}),e.jsxs(r,{variant:"destructive",onClick:()=>{N(s),h(!0)},disabled:c===s.deposit.id,className:"w-full",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]})})},s.deposit.id))})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-semibold mb-4",children:["Processed Deposits (",d.length,")"]}),d.length===0?e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsx(i,{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-400",children:"No processed deposits yet."})})}):e.jsx("div",{className:"space-y-4",children:d.map(s=>e.jsx(l,{className:"bg-slate-800 border-slate-700",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:s.user.name}),e.jsx("p",{className:"text-sm text-gray-400",children:s.user.email})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-white",children:[s.deposit.depositAmount," ",s.deposit.cryptocurrency]}),e.jsx("p",{className:"text-sm text-gray-400",children:b(s.deposit.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{variant:"secondary",children:s.deposit.paymentMethod}),e.jsx(y,{className:T(s.deposit.status),children:s.deposit.status.toUpperCase()})]})]}),s.deposit.status==="rejected"&&s.deposit.rejectionReason&&e.jsx("div",{className:"mt-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-400",children:[e.jsx("strong",{children:"Rejection Reason:"})," ",s.deposit.rejectionReason]})})]})},s.deposit.id))})]}),e.jsx(U,{open:R,onOpenChange:h,children:e.jsxs(H,{className:"bg-slate-800 border-slate-700",children:[e.jsx(L,{children:e.jsx(z,{children:"Reject Deposit"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Please provide a reason for rejecting this deposit:"}),e.jsx(q,{value:p,onChange:s=>f(s.target.value),placeholder:"Enter rejection reason...",className:"bg-slate-900 border-slate-700 text-white"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(r,{variant:"outline",onClick:()=>{h(!1),f(""),N(null)},className:"flex-1",children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:S,disabled:!p.trim()||c===o?.deposit.id,className:"flex-1",children:c===o?.deposit.id?"Rejecting...":"Reject Deposit"})]})]})]})})]})})}export{_ as default};
