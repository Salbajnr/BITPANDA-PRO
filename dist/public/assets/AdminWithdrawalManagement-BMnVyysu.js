import{a as Z,b as ee,r as m,c as _,d as F,j as e,q as h,R as u,C as v,h as y,i as b,ay as k,l as f,_ as T,m as C,D,L as q,ag as se,ah as ae,ai as te,aj as re,ak as l,a8 as I,o as ie,s as le,t as ne,v as de,a6 as K,az as W,aA as R,O as ce,B as oe,aB as xe,aC as me,ae as he}from"./index-locF26TT.js";function je(){const{toast:n}=Z(),c=ee(),[a,Q]=m.useState(null),[B,o]=m.useState(!1),[j,p]=m.useState(""),[S,A]=m.useState(""),[x,i]=m.useState(null),[g,P]=m.useState("all"),{data:L=[],isLoading:$,refetch:O}=_({queryKey:["/api/withdrawals/all"],queryFn:async()=>{const s=await R.get("/withdrawals/all");if(s.error)throw new Error(s.error);return s.data||[]}}),{data:N}=_({queryKey:["/api/withdrawals/stats"],queryFn:async()=>(await R.get("/withdrawals/stats")).data||{}}),U=F({mutationFn:async({id:s,adminNotes:r})=>{const t=await R.post(`/withdrawals/${s}/approve`,{adminNotes:r});if(t.error)throw new Error(t.error);return t.data},onSuccess:()=>{n({title:"Withdrawal Approved",description:"The withdrawal has been approved and is now processing."}),c.invalidateQueries({queryKey:["/api/withdrawals/all"]}),c.invalidateQueries({queryKey:["/api/withdrawals/stats"]}),o(!1),p(""),i(null)},onError:s=>{n({title:"Error",description:s.message||"Failed to approve withdrawal",variant:"destructive"}),i(null)}}),V=F({mutationFn:async({id:s,adminNotes:r,rejectionReason:t})=>{const w=await R.post(`/withdrawals/${s}/reject`,{adminNotes:r,rejectionReason:t});if(w.error)throw new Error(w.error);return w.data},onSuccess:()=>{n({title:"Withdrawal Rejected",description:"The withdrawal has been rejected and funds returned to user."}),c.invalidateQueries({queryKey:["/api/withdrawals/all"]}),c.invalidateQueries({queryKey:["/api/withdrawals/stats"]}),o(!1),p(""),A(""),i(null)},onError:s=>{n({title:"Error",description:s.message||"Failed to reject withdrawal",variant:"destructive"}),i(null)}}),z=F({mutationFn:async({id:s,adminNotes:r})=>{const t=await R.post(`/withdrawals/${s}/complete`,{adminNotes:r});if(t.error)throw new Error(t.error);return t.data},onSuccess:()=>{n({title:"Withdrawal Completed",description:"The withdrawal has been marked as completed."}),c.invalidateQueries({queryKey:["/api/withdrawals/all"]}),c.invalidateQueries({queryKey:["/api/withdrawals/stats"]}),o(!1),p(""),i(null)},onError:s=>{n({title:"Error",description:s.message||"Failed to complete withdrawal",variant:"destructive"}),i(null)}}),M=s=>{const r={pending:{color:"bg-yellow-100 text-yellow-800 border-yellow-300",icon:T},pending_confirmation:{color:"bg-blue-100 text-blue-800 border-blue-300",icon:ce},under_review:{color:"bg-purple-100 text-purple-800 border-purple-300",icon:I},approved:{color:"bg-green-100 text-green-800 border-green-300",icon:C},rejected:{color:"bg-red-100 text-red-800 border-red-300",icon:W},processing:{color:"bg-blue-100 text-blue-800 border-blue-300",icon:u},completed:{color:"bg-green-100 text-green-800 border-green-300",icon:C},cancelled:{color:"bg-gray-100 text-gray-800 border-gray-300",icon:W}},t=r[s]||r.pending,w=t.icon;return e.jsxs(oe,{className:`${t.color} flex items-center space-x-1`,children:[e.jsx(w,{className:"w-3 h-3"}),e.jsx("span",{children:s.replace("_"," ").toUpperCase()})]})},H=s=>{switch(s){case"bank_transfer":return he;case"crypto_wallet":return D;case"paypal":return me;case"mobile_money":return xe;default:return D}},d=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(parseFloat(s)),J=s=>{if(!j.trim()){n({title:"Admin Notes Required",description:"Please provide admin notes before approving the withdrawal.",variant:"destructive"});return}i(s.id),U.mutate({id:s.id,adminNotes:j})},X=s=>{if(!S.trim()){n({title:"Rejection Reason Required",description:"Please provide a reason for rejecting the withdrawal.",variant:"destructive"});return}i(s.id),V.mutate({id:s.id,adminNotes:j||`Rejected: ${S}`,rejectionReason:S})},G=s=>{i(s.id),z.mutate({id:s.id,adminNotes:j||"Withdrawal completed successfully"})},Y=s=>{Q(s),p(s.adminNotes||""),A(""),o(!0)},E=L.filter(s=>g==="all"?!0:s.status===g);return e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Withdrawal Management"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Review and manage user withdrawal requests"})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsxs(h,{onClick:()=>O(),variant:"outline",className:"border-blue-500 text-blue-600 hover:bg-blue-50",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Refresh"]})})]})}),N&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsxs(v,{children:[e.jsx(y,{className:"pb-2",children:e.jsxs(b,{className:"text-sm font-medium text-gray-600 flex items-center",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Total Withdrawals"]})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:N.totalWithdrawals||0})})]}),e.jsxs(v,{children:[e.jsx(y,{className:"pb-2",children:e.jsxs(b,{className:"text-sm font-medium text-gray-600 flex items-center",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Pending Review"]})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:N.pendingWithdrawals||0})})]}),e.jsxs(v,{children:[e.jsx(y,{className:"pb-2",children:e.jsxs(b,{className:"text-sm font-medium text-gray-600 flex items-center",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Approved"]})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:N.approvedWithdrawals||0})})]}),e.jsxs(v,{children:[e.jsx(y,{className:"pb-2",children:e.jsxs(b,{className:"text-sm font-medium text-gray-600 flex items-center",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Total Volume"]})}),e.jsx(f,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:d(N.totalVolume?.toString()||"0")})})]})]}),e.jsxs(v,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{className:"text-xl font-bold text-gray-900",children:"Withdrawal Requests"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{htmlFor:"status-filter",children:"Filter by status:"}),e.jsxs(se,{value:g,onValueChange:P,children:[e.jsx(ae,{className:"w-48",children:e.jsx(te,{})}),e.jsxs(re,{children:[e.jsx(l,{value:"all",children:"All Withdrawals"}),e.jsx(l,{value:"pending",children:"Pending"}),e.jsx(l,{value:"pending_confirmation",children:"Pending Confirmation"}),e.jsx(l,{value:"under_review",children:"Under Review"}),e.jsx(l,{value:"approved",children:"Approved"}),e.jsx(l,{value:"rejected",children:"Rejected"}),e.jsx(l,{value:"processing",children:"Processing"}),e.jsx(l,{value:"completed",children:"Completed"}),e.jsx(l,{value:"cancelled",children:"Cancelled"})]})]})]})]})}),e.jsx(f,{children:$?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(u,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading withdrawals..."})]}):E.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Withdrawals Found"}),e.jsx("p",{className:"text-gray-600",children:g==="all"?"No withdrawal requests have been submitted yet.":`No ${g.replace("_"," ")} withdrawals found.`})]}):e.jsx("div",{className:"space-y-4",children:E.map(s=>{const r=H(s.withdrawalMethod);return e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(r,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900 text-lg",children:[d(s.amount)," ",s.currency]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.user?.username," (",s.user?.email,")"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[M(s.status),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>Y(s),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"View Details"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Method:"}),e.jsx("p",{className:"text-gray-600",children:s.withdrawalMethod.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Fees:"}),e.jsx("p",{className:"text-gray-600",children:d(s.fees)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Net Amount:"}),e.jsx("p",{className:"text-gray-600",children:d(s.netAmount)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Requested:"}),e.jsx("p",{className:"text-gray-600",children:new Date(s.requestedAt).toLocaleDateString()})]})]}),s.adminNotes&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded border",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:"Admin Notes:"}),e.jsx("div",{className:"text-sm text-blue-700",children:s.adminNotes})]})]},s.id)})})})]}),e.jsx(ie,{open:B,onOpenChange:o,children:e.jsxs(le,{className:"max-w-2xl bg-gray-900 text-white",children:[e.jsx(ne,{children:e.jsx(de,{className:"text-xl font-bold",children:"Withdrawal Details"})}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"User:"}),e.jsxs("p",{className:"text-white font-medium",children:[a.user?.firstName," ",a.user?.lastName]}),e.jsx("p",{className:"text-gray-300 text-sm",children:a.user?.email})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Amount:"}),e.jsxs("p",{className:"text-white font-medium text-lg",children:[d(a.amount)," ",a.currency]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Method:"}),e.jsx("p",{className:"text-white",children:a.withdrawalMethod.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Destination:"}),e.jsx("p",{className:"text-white truncate",children:a.destinationAddress})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Fees:"}),e.jsx("p",{className:"text-white",children:d(a.fees)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Net Amount:"}),e.jsx("p",{className:"text-white font-medium",children:d(a.netAmount)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"mt-1",children:M(a.status)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Created:"}),e.jsx("p",{className:"text-white",children:new Date(a.createdAt).toLocaleString()})]})]}),a.destinationDetails&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Destination Details:"}),e.jsx("pre",{className:"text-white text-sm bg-gray-800 p-3 rounded mt-2",children:JSON.stringify(a.destinationDetails,null,2)})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"adminNotes",children:"Admin Notes"}),e.jsx(K,{id:"adminNotes",placeholder:"Enter admin notes...",value:j,onChange:s=>p(s.target.value),className:"mt-1 bg-gray-800 border-gray-700 text-white"})]}),a.status==="under_review"&&e.jsxs("div",{children:[e.jsx(q,{htmlFor:"rejectionReason",children:"Rejection Reason (if rejecting)"}),e.jsx(K,{id:"rejectionReason",placeholder:"Enter rejection reason...",value:S,onChange:s=>A(s.target.value),className:"mt-1 bg-gray-800 border-gray-700 text-white"})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[a.status==="under_review"&&e.jsxs(e.Fragment,{children:[e.jsxs(h,{onClick:()=>J(a),disabled:x===a.id,className:"bg-green-600 hover:bg-green-700",children:[x===a.id?e.jsx(u,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(C,{className:"w-4 h-4 mr-2"}),"Approve Withdrawal"]}),e.jsxs(h,{onClick:()=>X(a),disabled:x===a.id,className:"bg-red-600 hover:bg-red-700",children:[x===a.id?e.jsx(u,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(W,{className:"w-4 h-4 mr-2"}),"Reject Withdrawal"]})]}),a.status==="processing"&&e.jsxs(h,{onClick:()=>G(a),disabled:x===a.id,className:"bg-blue-600 hover:bg-blue-700",children:[x===a.id?e.jsx(u,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(C,{className:"w-4 h-4 mr-2"}),"Mark as Completed"]}),e.jsx(h,{variant:"outline",onClick:()=>o(!1),children:"Close"})]})]})]})})]})})}export{je as default};
